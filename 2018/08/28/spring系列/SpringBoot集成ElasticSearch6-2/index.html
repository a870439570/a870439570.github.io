<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ElasticSearch,">





  <link rel="alternate" href="/atom.xml" title="印象博客" type="application/atom+xml">






<meta name="description" content="elasticsearch (Java High Level REST Client) apiJava高级REST客户端在Java低级REST客户端之上工作。它的主要目标是公开API特定的方法，接受请求对象作为参数并返回响应对象，以便客户端自己处理请求编组和响应非编组。 可以同步或异步调用每个API。同步方法返回响应对象，而名称以async后缀结尾的异步方法需要一旦收到响应或错误就通知（在由低级客">
<meta name="keywords" content="ElasticSearch">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot集成ElasticSearch6.2">
<meta property="og:url" content="https://qinxuewu.github.io/2018/08/28/spring系列/SpringBoot集成ElasticSearch6-2/index.html">
<meta property="og:site_name" content="印象博客">
<meta property="og:description" content="elasticsearch (Java High Level REST Client) apiJava高级REST客户端在Java低级REST客户端之上工作。它的主要目标是公开API特定的方法，接受请求对象作为参数并返回响应对象，以便客户端自己处理请求编组和响应非编组。 可以同步或异步调用每个API。同步方法返回响应对象，而名称以async后缀结尾的异步方法需要一旦收到响应或错误就通知（在由低级客">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://wx1.sinaimg.cn/large/006b7Nxngy1g1eu6ewhl9j30760763yz.jpg">
<meta property="og:updated_time" content="2019-08-31T02:21:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringBoot集成ElasticSearch6.2">
<meta name="twitter:description" content="elasticsearch (Java High Level REST Client) apiJava高级REST客户端在Java低级REST客户端之上工作。它的主要目标是公开API特定的方法，接受请求对象作为参数并返回响应对象，以便客户端自己处理请求编组和响应非编组。 可以同步或异步调用每个API。同步方法返回响应对象，而名称以async后缀结尾的异步方法需要一旦收到响应或错误就通知（在由低级客">
<meta name="twitter:image" content="http://wx1.sinaimg.cn/large/006b7Nxngy1g1eu6ewhl9j30760763yz.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://qinxuewu.github.io/2018/08/28/spring系列/SpringBoot集成ElasticSearch6-2/">





  <title>SpringBoot集成ElasticSearch6.2 | 印象博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?96c30928a2ca92d1a2dce136bde0ab81";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">印象博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-主页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            主页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-工具">
          <a href="/Brain/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            工具
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://qinxuewu.github.io/2018/08/28/spring系列/SpringBoot集成ElasticSearch6-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qinxuewu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/logo_qinxuewu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="印象博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">SpringBoot集成ElasticSearch6.2</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-28T14:06:11+08:00">
                2018-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="elasticsearch-Java-High-Level-REST-Client-api"><a href="#elasticsearch-Java-High-Level-REST-Client-api" class="headerlink" title="elasticsearch (Java High Level REST Client) api"></a>elasticsearch (Java High Level REST Client) api</h2><p>Java高级REST客户端在Java低级REST客户端之上工作。它的主要目标是公开API特定的方法，接受请求对象作为参数并返回响应对象，以便客户端自己处理请求编组和响应非编组。</p>
<p>可以同步或异步调用每个API。同步方法返回响应对象，而名称以async后缀结尾的异步方法需要一旦收到响应或错误就通知（在由低级客户端管理的线程池上）的侦听器参数。</p>
<p>Java高级REST客户端依赖于Elasticsearch核心项目。它接受与the相同的请求参数，TransportClient并返回相同的响应对象。</p>
<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p>Java高级REST客户端需要Java 1.8并依赖于Elasticsearch核心项目。客户端版本与客户端开发的Elasticsearch版本相同。它接受与the相同的请求参数，TransportClient 并返回相同的响应对象</p>
<h2 id="代码初始化方式"><a href="#代码初始化方式" class="headerlink" title="代码初始化方式"></a>代码初始化方式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">        RestClient.builder(</span><br><span class="line">                <span class="keyword">new</span> HttpHost(<span class="string">"localhost"</span>, <span class="number">9200</span>, <span class="string">"http"</span>),</span><br><span class="line">                <span class="keyword">new</span> HttpHost(<span class="string">"localhost"</span>, <span class="number">9201</span>, <span class="string">"http"</span>)));</span><br></pre></td></tr></table></figure>

<p>IDE新建SpringBoot项目<br>pom.xml配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;6.2.3&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;6.2.3&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;elasticsearch-rest-client&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;6.2.3&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;elasticsearch-rest-client-sniffer&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;6.2.3&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.2.16&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>application.properties</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.port=80</span><br><span class="line">server.servlet.context-path=/es-boot</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=192.168.1.191:9200</span><br></pre></td></tr></table></figure>

<p>数据配置，进行初始化操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  elasticsearch spring-data 目前支持的最高版本为5.5 所以需要自己注入生成客户端</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 数据配置，进行初始化操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qinxuewu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span> 28/8/2018下午 5:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ESConfiguration</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">RestHighLevelClient</span>&gt;, <span class="title">InitializingBean</span>, <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(ESConfiguration.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.data.elasticsearch.cluster-nodes&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String clusterNodes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient restHighLevelClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 控制Bean的实例化过程</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restHighLevelClient;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取接口返回的实例的class</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> RestHighLevelClient.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (restHighLevelClient != <span class="keyword">null</span>) &#123;</span><br><span class="line">                restHighLevelClient.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">            LOG.error(<span class="string">"Error closing ElasticSearch client: "</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        restHighLevelClient = buildClient();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RestHighLevelClient <span class="title">buildClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            restHighLevelClient = <span class="keyword">new</span> RestHighLevelClient(RestClient.builder(<span class="keyword">new</span> HttpHost(clusterNodes.split(<span class="string">":"</span>)[<span class="number">0</span>], Integer.parseInt(clusterNodes.split(<span class="string">":"</span>)[<span class="number">1</span>]), <span class="string">"http"</span>)));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOG.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restHighLevelClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EsDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(EsDao.class);</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断索引是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引(关系型数据库)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIndexExist</span><span class="params">(String index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            GetRequest getRequest=<span class="keyword">new</span> GetRequest(index);</span><br><span class="line">            getRequest.fetchSourceContext(<span class="keyword">new</span> FetchSourceContext(<span class="keyword">false</span>));</span><br><span class="line">            getRequest.storedFields(<span class="string">"_none_"</span>);</span><br><span class="line">            <span class="keyword">boolean</span> exists = client.exists(getRequest);</span><br><span class="line">            <span class="keyword">return</span> exists;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            LOG.error(<span class="string">"判断索引是否存在是否存在异常"</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断索引是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id     数据ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIndexExist</span><span class="params">(String index,String type,String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            GetRequest getRequest=<span class="keyword">new</span> GetRequest(index,type,id);</span><br><span class="line">            getRequest.fetchSourceContext(<span class="keyword">new</span> FetchSourceContext(<span class="keyword">false</span>));</span><br><span class="line">            getRequest.storedFields(<span class="string">"_none_"</span>);</span><br><span class="line">            <span class="keyword">boolean</span> exists = client.exists(getRequest);</span><br><span class="line">            <span class="keyword">return</span> exists;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            LOG.error(<span class="string">"判断索引是否存在是否存在异常"</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj    数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndexOne</span><span class="params">(String index, String type, JSONObject obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            IndexRequest request = <span class="keyword">new</span> IndexRequest(index, type);</span><br><span class="line">            request.source(obj.toJSONString(), XContentType.JSON);</span><br><span class="line">            client.index(request);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOG.error(<span class="string">"创建索引异常"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 创建索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> id     数据ID</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> obj    数据源</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndexOne</span><span class="params">(String index, String type,String id, JSONObject obj)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                IndexRequest request=<span class="keyword">new</span> IndexRequest(index,type,id);</span><br><span class="line">                request.source(obj.toJSONString(),XContentType.JSON);</span><br><span class="line">                client.index(request);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                LOG.error(<span class="string">"创建索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 批量创建索</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> list   数据源</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bacthIndex</span><span class="params">(String index, String type,List&lt;JSONObject&gt; list)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;IndexRequest&gt; requests = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                list.forEach(i-&gt;&#123;</span><br><span class="line">                    requests.add(generateNewsRequest(index,type,i));</span><br><span class="line">                &#125;);</span><br><span class="line">                BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">                <span class="keyword">for</span> (IndexRequest indexRequest : requests) &#123;</span><br><span class="line">                    bulkRequest.add(indexRequest);</span><br><span class="line">                &#125;</span><br><span class="line">                client.bulk(bulkRequest);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                LOG.error(<span class="string">"批量创建索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IndexRequest <span class="title">generateNewsRequest</span><span class="params">(String index, String type,JSONObject obj)</span></span>&#123;</span><br><span class="line">            IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(index, type);</span><br><span class="line">            indexRequest.source(obj.toJSONString(),XContentType.JSON);</span><br><span class="line">            <span class="keyword">return</span> indexRequest;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 删除索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> id     数据ID</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteIndex</span><span class="params">(String index,String type,String id)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                DeleteRequest request=<span class="keyword">new</span> DeleteRequest(index,type,id);</span><br><span class="line">                client.delete(request);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                LOG.error(<span class="string">"删除索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 修改索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> id     数据ID</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> obj    数据源</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateIndex</span><span class="params">(String index, String type,String id, JSONObject obj)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(index,type,id);</span><br><span class="line">                updateRequest.doc(obj.toJSONString(),XContentType.JSON);</span><br><span class="line">                client.update(updateRequest);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                LOG.error(<span class="string">"修改索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 查询单条索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index  索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type   类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> id     数据ID</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> GetResponse <span class="title">findById</span><span class="params">(String index, String type,String id)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                GetRequest getRequest=<span class="keyword">new</span> GetRequest(index,type,id);</span><br><span class="line">                GetResponse getResponse = client.get(getRequest);</span><br><span class="line">                <span class="keyword">return</span> getResponse;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOG.error(<span class="string">"查询单条索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 查询单条索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index     索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type      类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> id        数据ID</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> includes  显示字段</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> excludes  排除字段</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> GetResponse <span class="title">findById</span><span class="params">(String index, String type,String id,String [] includes,String [] excludes)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                GetRequest getRequest=<span class="keyword">new</span> GetRequest(index,type,id);</span><br><span class="line">                FetchSourceContext fetchSourceContext = <span class="keyword">new</span> FetchSourceContext(<span class="keyword">true</span>, includes, excludes);</span><br><span class="line">                getRequest.fetchSourceContext(fetchSourceContext);</span><br><span class="line">                GetResponse getResponse = client.get(getRequest);</span><br><span class="line">                <span class="keyword">return</span>  getResponse;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOG.error(<span class="string">"查询单条索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 查询列表索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index        索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type         类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SearchResponse <span class="title">getAllIndex</span><span class="params">(String index,String type)</span></span>&#123;</span><br><span class="line">            SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">            SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">            searchRequest.types(type);</span><br><span class="line">            searchRequest.source(sourceBuilder);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                SearchResponse response = client.search(searchRequest);</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                LOG.error(<span class="string">"查询列表索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询列表索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index        索引(关系型数据库)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type         类型(关系型数据表)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> includes     显示字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> excludes     排除字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SearchResponse <span class="title">getAllIndex</span><span class="params">(String index, String type,String [] includes,String [] excludes)</span></span>&#123;</span><br><span class="line">        SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        sourceBuilder.fetchSource(includes,excludes);</span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        searchRequest.types(type);</span><br><span class="line">        searchRequest.source(sourceBuilder);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SearchResponse response = client.search(searchRequest);</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            LOG.error(<span class="string">"查询列表索引异常"</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 查询列表索引</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> index        索引(关系型数据库)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> type         类型(关系型数据表)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> sourceBuilder  查询条件</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SearchResponse <span class="title">getAllIndex</span><span class="params">(String index, String type, SearchSourceBuilder sourceBuilder)</span></span>&#123;</span><br><span class="line">            SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">            searchRequest.types(type);</span><br><span class="line">            searchRequest.source(sourceBuilder);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                SearchResponse response = client.search(searchRequest);</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                LOG.error(<span class="string">"查询列表索引异常"</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建索引</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> EsDao esDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndexOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">            String type=<span class="string">"userinfo"</span>;</span><br><span class="line">            JSONObject obj=<span class="keyword">new</span> JSONObject();</span><br><span class="line">            obj.put(<span class="string">"name"</span>,<span class="string">"qxw"</span>);</span><br><span class="line">            obj.put(<span class="string">"age"</span>,<span class="number">25</span>);</span><br><span class="line">            obj.put(<span class="string">"sex"</span>,<span class="string">"男"</span>);</span><br><span class="line">            String [] tags=&#123;<span class="string">"标签1"</span>,<span class="string">"标签2"</span>&#125;;</span><br><span class="line">            obj.put(<span class="string">"tags"</span>,tags);</span><br><span class="line">            esDao.createIndexOne(index,type,obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>批量创建索引</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bacthIndex</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">    String type=<span class="string">"userinfo"</span>;</span><br><span class="line">    List&lt;JSONObject&gt;  list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    JSONObject obj=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">        obj=<span class="keyword">new</span> JSONObject();</span><br><span class="line">        obj.put(<span class="string">"name"</span>,<span class="string">"qxw"</span>+i);</span><br><span class="line">        obj.put(<span class="string">"age"</span>,<span class="number">25</span>+i);</span><br><span class="line">        list.add(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    esDao.bacthIndex(index,type,list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>根据ID查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findById</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">    String type=<span class="string">"userinfo"</span>;</span><br><span class="line">    String id=<span class="string">"NWrCg2UBU-HvVB1XZxe1"</span>;</span><br><span class="line">    String result=esDao.findById(index,type,id);</span><br><span class="line">    System.out.println(<span class="string">"查询结果："</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改操作</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">     String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">     String type=<span class="string">"userinfo"</span>;</span><br><span class="line">     String id=<span class="string">"NWrCg2UBU-HvVB1XZxe1"</span>;</span><br><span class="line">     JSONObject obj=<span class="keyword">new</span> JSONObject();</span><br><span class="line">     obj.put(<span class="string">"name"</span>,<span class="string">"xiaoming"</span>);</span><br><span class="line">     obj.put(<span class="string">"time"</span>,<span class="string">"2018-08-29 00:00:00"</span>);</span><br><span class="line">     esDao.updateIndex(index,type,id,obj);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>根据ID查询 指定过滤字段</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据ID查询</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findById</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">      String type=<span class="string">"userinfo"</span>;</span><br><span class="line">      String id=<span class="string">"NWrCg2UBU-HvVB1XZxe1"</span>;</span><br><span class="line">      GetResponse res=esDao.findById(index,type,id);</span><br><span class="line">      System.out.println(<span class="string">"查询结果index："</span>+res.getIndex());</span><br><span class="line">      System.out.println(<span class="string">"查询结果type："</span>+res.getType());</span><br><span class="line">      System.out.println(<span class="string">"查询结果id："</span>+res.getId());</span><br><span class="line">      System.out.println(<span class="string">"查询结果source："</span>+res.getSource());</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据ID查询 指定过滤字段</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdexcludes</span><span class="params">()</span></span>&#123;</span><br><span class="line">      String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">      String type=<span class="string">"userinfo"</span>;</span><br><span class="line">      String id=<span class="string">"NWrCg2UBU-HvVB1XZxe1"</span>;</span><br><span class="line">      String [] includes=&#123;<span class="string">"name"</span>,<span class="string">"sex"</span>,<span class="string">"age"</span>&#125;;<span class="comment">//不过滤</span></span><br><span class="line">      String [] excludes=&#123;<span class="string">"tags"</span>&#125;; <span class="comment">//过滤字段</span></span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">"查询结果："</span>+esDao.findById(index,type,id,includes,excludes));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>查询所有</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">getAllIndex</span><span class="params">()</span></span>&#123;</span><br><span class="line">       String index=<span class="string">"testdb"</span>;  <span class="comment">//必须为小写</span></span><br><span class="line">       String type=<span class="string">"userinfo"</span>;</span><br><span class="line">       String result=esDao.getAllIndex(index,type);</span><br><span class="line">       System.out.println(<span class="string">"查询结果："</span>+result);</span><br><span class="line"></span><br><span class="line">       String [] includes=&#123;<span class="string">"name"</span>,<span class="string">"sex"</span>,&#125;;<span class="comment">//不过滤</span></span><br><span class="line">       String [] excludes=&#123;<span class="string">"tags"</span>,<span class="string">"age"</span>&#125;; <span class="comment">//过滤字段</span></span><br><span class="line">       String result2=esDao.getAllIndex(index,type,includes,excludes);</span><br><span class="line">       System.out.println(<span class="string">"指定过滤字段查询结果："</span>+result2);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>条件查询 /匹配所有</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">getAllIndexByFiled</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String index=<span class="string">"testdb"</span>;</span><br><span class="line">    String type=<span class="string">"userinfo"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用QueryBuilder</span></span><br><span class="line"><span class="comment">     * termQuery("key", obj) 完全匹配</span></span><br><span class="line"><span class="comment">     * termsQuery("key", obj1, obj2..)   一次匹配多个值</span></span><br><span class="line"><span class="comment">     * matchQuery("key", Obj) 单个匹配, field不支持通配符, 前缀具高级特性</span></span><br><span class="line"><span class="comment">     * multiMatchQuery("text", "field1", "field2"..);  匹配多个字段, field有通配符忒行</span></span><br><span class="line"><span class="comment">     * matchAllQuery();         匹配所有文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//匹配所有文件</span></span><br><span class="line">    SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    searchSourceBuilder.query(QueryBuilders.matchAllQuery());</span><br><span class="line">    String result=esDao.getAllIndex(index,type,searchSourceBuilder);</span><br><span class="line">    System.out.println(<span class="string">"匹配所有查询结果："</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>模糊、排序查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title">getAllIndexByFiled3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String index=<span class="string">"testdb"</span>;</span><br><span class="line">        String type=<span class="string">"userinfo"</span>;</span><br><span class="line">   </span><br><span class="line">        SearchSourceBuilder search3 = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line"><span class="comment">//        MatchQueryBuilder matchQueryBuilder = new MatchQueryBuilder("name","qxw");</span></span><br><span class="line">         <span class="comment">//在匹配查询上启用模糊匹配</span></span><br><span class="line"><span class="comment">//        matchQueryBuilder.fuzziness(Fuzziness.AUTO);</span></span><br><span class="line"><span class="comment">//        //在匹配查询上设置前缀长度选项</span></span><br><span class="line"><span class="comment">//        matchQueryBuilder.prefixLength(3); </span></span><br><span class="line"><span class="comment">//        //设置最大扩展选项以控制查询的模糊过程</span></span><br><span class="line"><span class="comment">//        matchQueryBuilder.maxExpansions(10); </span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//默认情况下，搜索请求会返回文档的内容,设置fasle不会返回窝</span></span><br><span class="line"><span class="comment">//        search3.fetchSource(false);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//也接受一个或多个通配符模式的数组，以控制以更精细的方式包含或排除哪些字段</span></span><br><span class="line">        String[] includeFields = <span class="keyword">new</span> String[] &#123;<span class="string">"name"</span>, <span class="string">"age"</span>, <span class="string">"tags"</span>&#125;;</span><br><span class="line">        String[] excludeFields = <span class="keyword">new</span> String[] &#123;<span class="string">"_type"</span>,<span class="string">"_index"</span>&#125;;</span><br><span class="line">        search3.fetchSource(includeFields, excludeFields);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//指定排序</span></span><br><span class="line">        search3.sort(<span class="keyword">new</span> FieldSortBuilder(<span class="string">"age"</span>).order(SortOrder.DESC));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="comment">//启用模糊查询 fuzziness(Fuzziness.AUTO)</span></span><br><span class="line"><span class="comment">//        search3.query(QueryBuilders.matchQuery("name","qxw").fuzziness(Fuzziness.AUTO));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//模糊查询，?匹配单个字符，*匹配多个字符</span></span><br><span class="line"><span class="comment">//        search3.query(QueryBuilders.wildcardQuery("name","*qxw*"));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//搜索name中或tags  中包含有qxw的文档（必须与music一致)</span></span><br><span class="line"><span class="comment">//        search3.query(QueryBuilders.multiMatchQuery("qxw","name","tags"));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//多条件查询 相当于and</span></span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="comment">//查询age=32</span></span><br><span class="line">        TermQueryBuilder termQuery=QueryBuilders.termQuery(<span class="string">"age"</span>,<span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//匹配多个值  相当于sql 中in(....)操作</span></span><br><span class="line">        TermsQueryBuilder termQuerys=QueryBuilders.termsQuery(<span class="string">"_id"</span>,<span class="string">"PWrIg2UBU-HvVB1XzRce"</span>,<span class="string">"XWqYhGUBU-HvVB1Xahct"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模糊查询name中包含qxw</span></span><br><span class="line">        WildcardQueryBuilder queryBuilder = QueryBuilders.wildcardQuery(<span class="string">"name"</span>, <span class="string">"*qxw*"</span>);</span><br><span class="line"></span><br><span class="line">        boolQueryBuilder.must(termQuery);</span><br><span class="line">        boolQueryBuilder.must(queryBuilder);</span><br><span class="line">        boolQueryBuilder.must(termQuerys);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        //设置from确定结果索引的选项以开始搜索。默认为0。</span></span><br><span class="line"><span class="comment">//        search3.from(0);</span></span><br><span class="line"><span class="comment">//        //设置size确定要返回的搜索命中数的选项。默认为10。</span></span><br><span class="line"><span class="comment">//        search3.size(1);</span></span><br><span class="line"></span><br><span class="line">        search3.query(boolQueryBuilder);</span><br><span class="line"></span><br><span class="line">        SearchResponse result=esDao.getAllIndex(index,type,search3);</span><br><span class="line">        <span class="comment">//解析SearchHits</span></span><br><span class="line">        SearchHits hits = result.getHits();</span><br><span class="line">        <span class="keyword">long</span> totalHits = hits.getTotalHits();</span><br><span class="line">        <span class="keyword">float</span> maxScore = hits.getMaxScore();</span><br><span class="line"></span><br><span class="line">        SearchHit[] searchHits = hits.getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : searchHits) &#123;</span><br><span class="line">            String indexs = hit.getIndex();</span><br><span class="line">            String types = hit.getType();</span><br><span class="line">            String ids = hit.getId();</span><br><span class="line"></span><br><span class="line">            String sourceAsString = hit.getSourceAsString();</span><br><span class="line">            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">            System.out.println(<span class="string">"id ："</span>+ids+sourceAsMap.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"查询结果："</span>+esDao.getAllIndex(index,type,search3));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="聚合操作"><a href="#聚合操作" class="headerlink" title="聚合操作"></a>聚合操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">AggregationsTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">          String index=<span class="string">"emptydb"</span>;</span><br><span class="line">          String  type=<span class="string">"empty"</span>;</span><br><span class="line"><span class="comment">//        List&lt;JSONObject&gt;  list=new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        JSONObject obj=new JSONObject();</span></span><br><span class="line"><span class="comment">//        obj.put("name","小明"); obj.put("age",25); obj.put("salary",10000); obj.put("detpty","技术部");</span></span><br><span class="line"><span class="comment">//        list.add(obj);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        JSONObject obj2=new JSONObject();</span></span><br><span class="line"><span class="comment">//        obj2.put("name","小蛋"); obj2.put("age",22); obj2.put("salary",5000); obj2.put("detpty","技术部");</span></span><br><span class="line"><span class="comment">//        list.add(obj2);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        JSONObject obj3=new JSONObject();</span></span><br><span class="line"><span class="comment">//        obj3.put("name","张三"); obj3.put("age",24); obj3.put("salary",300); obj3.put("detpty","销售部");</span></span><br><span class="line"><span class="comment">//        list.add(obj3);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        JSONObject obj4=new JSONObject();</span></span><br><span class="line"><span class="comment">//        obj4.put("name","李四"); obj4.put("age",22); obj4.put("salary",4000); obj4.put("detpty","采购部");</span></span><br><span class="line"><span class="comment">//        list.add(obj4);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//          //添加测试数据</span></span><br><span class="line"><span class="comment">//        esDao.bacthIndex(index,type,list);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(index);</span><br><span class="line">        searchRequest.types(type);</span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//计算所有员工的平均年龄</span></span><br><span class="line">        <span class="comment">//terms(查询字段别名).field(分组字段)</span></span><br><span class="line">        searchSourceBuilder.aggregation(AggregationBuilders.avg(<span class="string">"average_age"</span>).field(<span class="string">"age"</span>));</span><br><span class="line">        SearchResponse res=client.search(searchRequest);</span><br><span class="line">        System.out.println(<span class="string">"聚合操作查询结果："</span>+res.toString());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Aggregations aggregations = res.getAggregations();</span><br><span class="line">        Map&lt;String, Aggregation&gt; aggregationMap = aggregations.getAsMap();</span><br><span class="line">        System.out.println(<span class="string">"聚合操作解析："</span>+aggregationMap.toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://wx1.sinaimg.cn/large/006b7Nxngy1g1eu6ewhl9j30760763yz.jpg" alt="觉得本文不错的话，分享一下给小伙伴吧~"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ElasticSearch/" rel="tag"># ElasticSearch</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/27/java/ElasticSearch安装及java-Api使用/" rel="next" title="ElasticSearch安装及Api使用">
                <i class="fa fa-chevron-left"></i> ElasticSearch安装及Api使用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/28/java/Apache-Curator入门/" rel="prev" title="Zookeeper客户端Curator入门">
                Zookeeper客户端Curator入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/logo_qinxuewu.jpg" alt="qinxuewu">
            
              <p class="site-author-name" itemprop="name">qinxuewu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/qinxuewu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://gitee.com/qinxuewu" target="_blank" title="码云">
                      
                        <i class="fa fa-fw fa-google"></i>码云</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:870439570@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/spring-projects/spring-framework" title="spring" target="_blank">spring</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" title="SpringCloudAlibaba" target="_blank">SpringCloudAlibaba</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://leetcode-cn.com/" title="leetcode" target="_blank">leetcode</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://spring.io/projects/spring-cloud" title="SpringCloud" target="_blank">SpringCloud</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://spring.io/projects/spring-boot/" title="SpringBoot" target="_blank">SpringBoot</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#elasticsearch-Java-High-Level-REST-Client-api"><span class="nav-number">1.</span> <span class="nav-text">elasticsearch (Java High Level REST Client) api</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#兼容性"><span class="nav-number">2.</span> <span class="nav-text">兼容性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码初始化方式"><span class="nav-number">3.</span> <span class="nav-text">代码初始化方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#聚合操作"><span class="nav-number">4.</span> <span class="nav-text">聚合操作</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qinxuewu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>







  <div class="footer-custom">Hosted by <a target="_blank" href="https://github.com/qinxuewu">GitHub </a></div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


  
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>
